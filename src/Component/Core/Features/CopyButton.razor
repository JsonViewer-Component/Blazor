@using Component.Core.Shared
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<button @onclick="HandleCopyClick"
        class="@ButtonClass"
        title="@Title"
        disabled="@IsDisabled">
    <Icon Name="@IconName" />
    @if (!string.IsNullOrEmpty(ButtonText))
    {
        <span class="ms-1">@ButtonText</span>
    }
</button>

@code {
    /// <summary>
    /// Text content to be copied
    /// </summary>
    [Parameter]
    public string Content { get; set; } = string.Empty;

    /// <summary>
    /// Button tooltip text
    /// </summary>
    [Parameter]
    public string Title { get; set; } = "Copy";

    /// <summary>
    /// Button CSS classes
    /// </summary>
    [Parameter]
    public string ButtonClass { get; set; } = "btn btn-sm btn-light mb-2";

    /// <summary>
    /// Icon name (using Icon component)
    /// </summary>
    [Parameter]
    public string IconName { get; set; } = "clipboard";

    /// <summary>
    /// Optional text next to icon
    /// </summary>
    [Parameter]
    public string ButtonText { get; set; } = string.Empty;

    /// <summary>
    /// Success event - message returned to parent
    /// </summary>
    [Parameter]
    public EventCallback<string> OnCopySuccess { get; set; }

    /// <summary>
    /// Error event - error message returned to parent
    /// </summary>
    [Parameter]
    public EventCallback<string> OnCopyError { get; set; }

    /// <summary>
    /// Button is disabled when content is empty
    /// </summary>
    private bool IsDisabled => string.IsNullOrEmpty(Content);

    /// <summary>
    /// Handle copy button click
    /// </summary>
    private async Task HandleCopyClick()
    {
        if (string.IsNullOrEmpty(Content))
            return;

        try
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", Content);

            if (OnCopySuccess.HasDelegate)
                await OnCopySuccess.InvokeAsync("Copied to clipboard");
        }
        catch (Exception ex)
        {
            if (OnCopyError.HasDelegate)
                await OnCopyError.InvokeAsync($"Failed to copy: {ex.Message}");
        }
    }
}
